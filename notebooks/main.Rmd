---
title: "COVID-19 Data Analysis"
author: "By Seyed Rumaiz"
date: "2026-02-16"
output: pdf_document
always_allow_html: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(tidyverse)
library(lubridate)
library(maps)
library(janitor)
library(slider)
library(scales)
library(plotly)
library(countrycode)
```


```{r}
complete_data     <- read_csv("../data/covid_19_clean_complete.csv") %>% clean_names()
day_wise_data     <- read_csv("../data/day_wise.csv") %>% clean_names()
country_data      <- read_csv("../data/country_wise_latest.csv") %>% clean_names()
grouped_data      <- read_csv("../data/full_grouped.csv") %>% clean_names()
worldometer_data  <- read_csv("../data/worldometer_data.csv") %>% clean_names()
```

```{r}
day_wise_data <- day_wise_data %>% mutate(date = as.Date(date))
grouped_data  <- grouped_data  %>% mutate(date = as.Date(date))
```


```{r}
# Replace blanks with 0
country_data <- country_data %>% 
  mutate(across(where(is.numeric), ~replace_na(.x, 0)))
```

```{r}
cat("Rows in complete_data:", nrow(complete_data), "\n")
cat("Rows in day_wise_data:", nrow(day_wise_data), "\n")
cat("Rows in country_data:", nrow(country_data), "\n")
cat("Rows in grouped_data:", nrow(grouped_data), "\n")
cat("Rows in worldometer_data:", nrow(worldometer_data), "\n")
```

```{r}
summary(country_data)
```


```{r}
glimpse(country_data)
```

```{r}
colSums(is.na(country_data))
```

```{r}
world_map <- map_data("world")

plot_world_map <- function(df, column, title_text) {

  df2 <- df %>%
    rename(region = country_region) %>%
    mutate(region = case_when(
      region == "US" ~ "USA",
      TRUE ~ region
    ))

  merged <- left_join(world_map, df2, by = "region")

  ggplot(merged, aes(long, lat, group = group)) +
    geom_polygon(aes(fill = .data[[column]]), color = "gray40", size = 0.1) +
    scale_fill_viridis_c(option = "magma", na.value = "gray90") +
    labs(title = title_text, fill = column) +
    theme_void()
}
```

```{r}
plot_world_map(country_data, "confirmed", "Global Confirmed Cases")
```


```{r}
plot_world_map(country_data, "deaths", "Global Deaths")
```

```{r}
plot_world_map(country_data, "recovered", "Global Recovered Cases")
```

```{r}
plot_world_map(country_data, "active", "Global Active Cases")
```


```{r}
ggplot(day_wise_data, aes(date, deaths)) +
  geom_line(color = "purple") +
  labs(
    title = "Daily Global Deaths",
    x = "Date",
    y = "Deaths"
  )
```

```{r}
ggplot(day_wise_data, aes(date, confirmed)) +
  geom_line(color = "purple") +
  labs(
    title = "Daily Global Confirmed Cases",
    x = "Date",
    y = "Confirmed"
  )
```

```{r}
ggplot(day_wise_data, aes(date, recovered)) +
  geom_line(color = "purple") +
  labs(
    title = "Daily Global Recoveries",
    x = "Date",
    y = "Recovered"
  )
```


```{r}
ggplot(country_data,
       aes(confirmed, deaths,
           size = active,
           color = who_region)) +
  geom_point(alpha = 0.7) +
  scale_size_continuous(range = c(2, 15)) +
  labs(
    title = "Confirmed vs Deaths (Bubble size = Active Cases)",
    x = "Confirmed Cases",
    y = "Deaths"
  )
```

```{r}
# Calculate the daily new cases and 7-day rolling average

countries_to_compare <- c("US", "India", "Brazil")

daily_cases_df <- grouped_data %>% 
  arrange(country_region, date) %>% 
  group_by(country_region) %>% 
  mutate(
    daily_cases = confirmed - lag(confirmed),
    daily_cases = replace_na(daily_cases, 0),
    daily_cases_7day_avg = slide_dbl(
      daily_cases,
      mean,
      .before = 6,       # Previous 6 days + today
      .complete = T
    )
  ) %>% 
  ungroup()

daily_waves_plot_df <- daily_cases_df %>% 
  filter(country_region %in% countries_to_compare) %>% 
  filter(!is.na(daily_cases_7day_avg))

ggplot(daily_waves_plot_df,
       aes(x=date, y=daily_cases_7day_avg, color=country_region)) +
  geom_line(linewidth=1) +
  scale_y_continuous(labels=comma) +
    labs(
    title = "Pandemic Waves: 7-Day Average of Daily New Cases",
    subtitle = "Comparing infection surges in the US, India, and Brazil",
    x = "Date",
    y = "7-Day Average New Cases",
    color = "Country"
    ) +
  theme_minimal()
```

```{r}
country_data2 <- country_data %>%
  mutate(
    iso3 = countrycode(country_region, origin = "country.name", destination = "iso3c"),
    iso3 = if_else(country_region %in% c("US", "USA"), "USA", iso3)
  )

plot_world_choropleth <- function(df, value_col, title_text) {
  plot_ly(
    data = df,
    type = "choropleth",
    locations = ~iso3,
    z = df[[value_col]],
    text = ~paste0(
      country_region,
      "<br>", value_col, ": ", scales::comma(df[[value_col]])
    ),
    hoverinfo = "text",
    colorscale = "Magma",
    marker = list(line = list(color = "white", width = 0.3))
  ) %>%
    layout(
      title = list(text = title_text),
      geo = list(
        showframe = FALSE,
        showcoastlines = TRUE,
        projection = list(type = "natural earth")
      )
    )
}

plot_world_choropleth(country_data2, "confirmed", "Global Confirmed Cases")
```

```{r}
plot_world_choropleth(country_data2, "deaths", "Global Deaths")
```


```{r}
plot_world_choropleth(country_data2, "recovered", "Global Recovered Cases")
```

```{r}
plot_world_choropleth(country_data2, "active", "Global Active Cases")
```

